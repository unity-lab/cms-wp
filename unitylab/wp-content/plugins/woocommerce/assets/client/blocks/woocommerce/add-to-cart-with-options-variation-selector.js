import*as t from"@woocommerce/stores/woocommerce/cart";import*as e from"@woocommerce/stores/woocommerce/product-data";import*as r from"@wordpress/interactivity";var o={8228:(t,e,r)=>{r.d(e,{q:()=>o});const o=(t,e)=>{if(!t||!Object.keys(t).length||!Array.isArray(e)||0===e.length)return null;const r=Object.entries(t).find((([t,r])=>Object.entries(r.attributes).every((([t,r])=>e.some((e=>!(e.attribute!==t)&&(e.value===r||e.value&&""===r)))))));return r?{...r[1],variation_id:Number(r[0])}:null}},3132:(t,e,r)=>{r.d(e,{E:()=>c});var o=r(2833),n=(r(4021),r(8228));const a="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",{state:i}=(0,o.store)("woocommerce",{},{lock:a}),{state:s}=(0,o.store)("woocommerce/product-data",{},{lock:a}),c=(t,e)=>{let r,a=t;const{products:i}=(0,o.getConfig)("woocommerce");let s=null;if(e&&e.length>0){if(!i||!i[t])return null;const o=i[t].variations,c=(0,n.q)(o,e);c?.variation_id&&(a=c.variation_id,r=i?.[t]?.variations?.[c?.variation_id],s="variation")}else r=i?.[a],s=r?.type;if("object"!=typeof r||null===r)return null;const c="number"==typeof r.min?r.min:1,u="number"==typeof r.max&&r.max>=1?r.max:1/0,l=r.step||1;return{id:a,...r,min:c,max:u,step:l,type:s}},{actions:u,state:l}=(0,o.store)("woocommerce/add-to-cart-with-options",{state:{noticeIds:[],get validationErrors(){const t=(0,o.getContext)();return t&&t.validationErrors?t.validationErrors:[]},get isFormValid(){return 0===l.validationErrors.length},get quantity(){return(0,o.getContext)().quantity||{}},get selectedAttributes(){return(0,o.getContext)().selectedAttributes||[]}},actions:{validateQuantity(t,e){if(u.clearErrors("invalid-quantities"),"number"!=typeof e)return;const{selectedAttributes:r}=(0,o.getContext)(),n=c(t,r);if(0===e||n&&(e<n.min||e>n.max)){const{errorMessages:t}=(0,o.getConfig)();u.addError({code:"invalidQuantities",message:t?.invalidQuantities||"",group:"invalid-quantities"})}},setQuantity(t,e){const r=(0,o.getContext)(),{products:n}=(0,o.getConfig)("woocommerce"),a=n?.[t].variations;a?[t,...Object.keys(a)].forEach((t=>{r.quantity[Number(t)]=e})):r.quantity={...r.quantity,[t]:e};const i=c(s.productId,r.selectedAttributes);"grouped"===i?.type?u.validateGroupedProductQuantity():u.validateQuantity(t,e)},addError:t=>{const{validationErrors:e}=l;return e.push(t),t.code},clearErrors:t=>{const{validationErrors:e}=l;if(t){const r=e.filter((e=>e.group!==t));e.splice(0,e.length,...r)}else e.length=0},*addToCart(){yield Promise.resolve().then(r.bind(r,1401));const{selectedAttributes:t}=(0,o.getContext)(),e=s.variationId||s.productId,n=s.variationId?"variation":c(e,t)?.type;if(!n)return;if("grouped"===n)return void(yield u.batchAddToCart());const{quantity:l}=(0,o.getContext)(),d=((t,e,r)=>{const o=i.cart?.items.find((e=>{return"variation"===e.type?!(e.id!==t||!e.variation||!r||e.variation.length!==r.length)&&(o=e,n=r,!(!Array.isArray(o.variation)||!Array.isArray(n))&&o.variation.length===n.length&&o.variation.every((({raw_attribute:t,value:e})=>n.some((r=>r.attribute===t&&(r.value.toLowerCase()===e.toLowerCase()||r.value&&""===e)))))):e.id===t;var o,n}));return(o?.quantity||0)+e})(e,l[e],t),{actions:m}=(0,o.store)("woocommerce",{},{lock:a});yield m.addCartItem({id:e,quantity:d,variation:t,type:n},{showCartUpdatesNotices:!1})},*handleSubmit(t){t.preventDefault();const{isFormValid:e}=l;if(e)yield u.addToCart();else{yield Promise.resolve().then(r.bind(r,7908));const{actions:t}=(0,o.store)("woocommerce/store-notices",{},{lock:a}),{noticeIds:e,validationErrors:n}=l;e.forEach((e=>{t.removeNotice(e)})),e.splice(0,e.length);const i=n.map((e=>t.addNotice({notice:e.message,type:"error",dismissible:!0})));e.push(...i)}}}},{lock:a})},4768:(t,e,r)=>{r.d(e,{V:()=>c});var o=r(2833),n=(r(4021),r(3132));const a="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",i=(0,o.store)("woocommerce/add-to-cart-with-options",{},{lock:a}),{state:s}=(0,o.store)("woocommerce/product-data",{},{lock:a}),c=t=>{const e=new Event("change",{bubbles:!0});t.dispatchEvent(e)};(0,o.store)("woocommerce/add-to-cart-with-options-quantity-selector",{state:{get allowsDecrease(){const{quantity:t,selectedAttributes:e}=i.state,r=(0,n.E)(s.productId,e);if(!r)return!0;if("grouped"===r.type){const{productId:e}=(0,o.getContext)();return t[e]>0}const{id:a,min:c,step:u}=r;return(t[a]||0)-u>=c},get allowsIncrease(){const{quantity:t,selectedAttributes:e}=i.state,{productId:r}=(0,o.getContext)(),a=(0,n.E)(r,e);if(!a)return!0;const{id:s,max:c,step:u}=a;return(t[s]||0)+u<=c}},actions:{increaseQuantity:t=>{const e=t.target.parentElement?.querySelector(".qty");if(!(e instanceof HTMLInputElement))return;const r=Number(e.value)||0,{productId:a}=(0,o.getContext)(),{selectedAttributes:s}=i.state,u=(0,n.E)(a,s);let l=r+1;if(u){const{max:t,min:e,step:o}=u;l=r+o,l=Math.max(e,Math.min(t,l))}i.actions.setQuantity(a,l),e.value=l.toString(),c(e)},decreaseQuantity:t=>{const e=t.target.parentElement?.querySelector(".qty");if(!(e instanceof HTMLInputElement))return;const r=Number(e.value)||0,{productId:a}=(0,o.getContext)(),{selectedAttributes:u}=i.state,l=(0,n.E)(s.productId,u);let d=l;"grouped"===l?.type&&(d=(0,n.E)(a,u));let m=r-1;if(d){const{min:t,step:e}=d;m=r-e,m<t&&(m="grouped"===l?.type?r>t?t:0:t)}m!==r&&(i.actions.setQuantity(a,m),e.value=m.toString(),c(e))},handleQuantityBlur:t=>{const{selectedAttributes:e}=i.state;let r=1;const a=(0,n.E)(s.productId,e);if(!a)return;const{productId:u}=(0,o.getContext)();if((Number.isNaN(t.target.valueAsNumber)||0===t.target.valueAsNumber)&&"grouped"===a.type)return i.actions.setQuantity(u,0),Number.isNaN(t.target.valueAsNumber)&&(t.target.value=""),void c(t.target);let l=null;if("grouped"===a.type){if(l=(0,n.E)(u,e),!l)return}else l=a;r=l.min;const d=Number.isFinite(t.target.valueAsNumber)&&t.target.valueAsNumber>0?t.target.valueAsNumber:r;i.actions.setQuantity(u,d),t.target.value=d.toString(),c(t.target)},handleQuantityCheckboxChange:()=>{const t=(0,o.getElement)();if(!(t.ref instanceof HTMLInputElement))return;const{productId:e}=(0,o.getContext)();i.actions.setQuantity(e,t.ref.checked?1:0)}}},{lock:a})},7908:t=>{t.exports=import("@woocommerce/stores/store-notices")},1401:e=>{e.exports=t},4021:(t,e,r)=>{var o;t.exports=(o={},r.d(o,{}),o)},2833:(t,e,o)=>{var n,a;t.exports=(n={getConfig:()=>r.getConfig,getContext:()=>r.getContext,getElement:()=>r.getElement,store:()=>r.store},a={},o.d(a,n),a)}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={exports:{}};return o[t](r,r.exports,a),r.exports}a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i=a(2833),s=a(3132),c=a(4768),u=a(8228);function l(t,e){if(!t)return null;const r=window.getComputedStyle(t)[e];if("rgba(0, 0, 0, 0)"!==r&&"transparent"!==r){const t=r.match(/\d+/g);if(!t||t.length<3)return null;const[e,o,n]=t.slice(0,3);return`rgb(${e}, ${o}, ${n})`}return l(t.parentElement,e)}!function(){const t=document.querySelector(".wc-block-add-to-cart-with-options-variation-selector-attribute-options__pills");if(!t)return;const e=document.createElement("style"),r=l(t,"backgroundColor")||"#fff",o=l(t,"color")||"#000";e.appendChild(document.createTextNode(`:where(.wc-block-add-to-cart-with-options-variation-selector-attribute-options__pill:has(.wc-block-add-to-cart-with-options-variation-selector-attribute-options__pill-input:checked)) {\n\t\t\t\t--pill-color: ${r};\n\t\t\t\t--pill-background-color: ${o};\n\t\t\t}`)),document.head.appendChild(e)}();const d="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",{state:m}=(0,i.store)("woocommerce/product-data",{},{lock:d}),{actions:p,state:g}=(0,i.store)("woocommerce/add-to-cart-with-options",{state:{get selectedAttributes(){const t=(0,i.getContext)();return t?t.selectedAttributes:[]},get isOptionSelected(){const{selectedValue:t,option:e}=(0,i.getContext)();return t===e.value},get isOptionDisabled(){const{name:t,option:e,selectedAttributes:r}=(0,i.getContext)();return""!==e.value&&!(({attributeName:t,attributeValue:e,selectedAttributes:r})=>{if(!t||!e||!Array.isArray(r))return!1;const o=r.some((e=>e.attribute===t))?r.length-1:r.length,{products:n}=(0,i.getConfig)("woocommerce");return!(!n||!n[m.productId])&&Object.values(n[m.productId].variations||{}).some((n=>(n.attributes[t]===e||""===n.attributes[t])&&r.filter((r=>{const o=n.attributes[r.attribute];return o===r.value||""===o&&(r.attribute!==t||e===r.value)})).length>=o))})({attributeName:t,attributeValue:e.value,selectedAttributes:r})}},actions:{setAttribute(t,e){const{selectedAttributes:r}=(0,i.getContext)(),o=r.findIndex((e=>e.attribute===t));""!==e?o>=0?r[o]={attribute:t,value:e}:r.push({attribute:t,value:e}):o>=0&&r.splice(o,1)},removeAttribute(t){const{selectedAttributes:e}=(0,i.getContext)(),r=e.findIndex((e=>e.attribute===t));r>=0&&e.splice(r,1)},handlePillClick(){if(g.isOptionDisabled)return;const t=(0,i.getContext)();t.selectedValue===t.option.value?t.selectedValue="":t.selectedValue=t.option.value,p.setAttribute(t.name,t.selectedValue)},handleDropdownChange(t){const e=(0,i.getContext)();e.selectedValue=t.currentTarget.value,p.setAttribute(e.name,e.selectedValue)}},callbacks:{setDefaultSelectedAttribute(){const t=(0,i.getContext)();t.selectedValue&&p.setAttribute(t.name,t.selectedValue)},setSelectedVariationId:()=>{const{products:t}=(0,i.getConfig)("woocommerce"),e=t?.[m.productId].variations,{selectedAttributes:r}=(0,i.getContext)(),o=(0,u.q)(e,r),{actions:n}=(0,i.store)("woocommerce/product-data",{},{lock:d}),a=o?.variation_id||null;n.setVariationId(a)},validateVariation(){p.clearErrors("variable-product");const{products:t}=(0,i.getConfig)("woocommerce");if(!t||!t[m.productId])return;const e=t[m.productId].variations,{selectedAttributes:r}=(0,i.getContext)(),o=(0,u.q)(e,r),{errorMessages:n}=(0,i.getConfig)();o?.variation_id?o?.is_in_stock||p.addError({code:"variableProductOutOfStock",message:n?.variableProductOutOfStock||"",group:"variable-product"}):p.addError({code:"variableProductMissingAttributes",message:n?.variableProductMissingAttributes||"",group:"variable-product"})},watchQuantityConstraints(){const{ref:t}=(0,i.getElement)();if(!(t instanceof HTMLInputElement))return;if(t===document.activeElement)return;const{selectedAttributes:e}=(0,i.getContext)(),r=(0,s.E)(m.productId,e);if(r){const{quantity:e}=(0,i.getContext)(),o=e[r.id],{min:n,max:a}=r;let s=o;o<n?s=n:o>a&&(s=a),s===t.valueAsNumber&&s===o||(p.setQuantity(m.productId,s),t.value=s.toString(),(0,c.V)(t))}}}},{lock:d});